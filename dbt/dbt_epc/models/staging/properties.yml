models:
  - name: stg_display_certificates
    description: "Staging table for Display Certificates joined with audit metadata and incrementally loaded"
    columns:
      - name: lmk_key
        description: "Unique property key for the certificate"
        tests:
          - not_null
          - unique
      - name: audit_id
        description: "Audit ID linking to the raw_copy_audit table"
        tests:
          - not_null
          - relationships:
              to: source('raw', 'raw_copy_audit')
              field: audit_id
      - name: operational_rating_band
        description: "Energy rating category for display certificates"
        tests:
          - dbt_expectations.expect_column_distinct_values_to_be_in_set:
              value_set: ['A', 'B', 'C', 'D', 'E', 'F', 'G']

  - name: stg_display_recommendations
    description: "Staging table for Display Recommendations linked to certificates and incrementally loaded"
    columns:
      - name: lmk_key
        description: "Foreign key linking to stg_display_certificates"
        tests:
          - not_null
          - relationships:
              to: ref('stg_display_certificates')
              field: lmk_key
      - name: payback_type
        description: "Payback type categories for recommended actions"
        tests:
          - not_null
          - dbt_expectations.expect_column_distinct_values_to_be_in_set:
              value_set: ['short', 'medium', 'long', 'other']
      - name: co2_impact
        description: "CO2 impact categories for recommended actions"
        tests:
          - dbt_expectations.expect_column_distinct_values_to_be_in_set:
              value_set: ['HIGH', 'MEDIUM', 'LOW']
      - name: audit_id
        description: "Audit ID linking to the raw_copy_audit table"
        tests:
          - not_null
          - relationships:
              to: source('raw', 'raw_copy_audit')
              field: audit_id

  - name: stg_domestic_certificates
    description: "Staging model for Domestic Certificates and incrementally loaded"
    columns:
      - name: lmk_key
        description: "Unique property key for the certificate"
        tests:
          - not_null
          - unique
      - name: current_energy_rating
        description: "Energy rating band for domestic properties"
        tests:
          - dbt_expectations.expect_column_distinct_values_to_be_in_set:
              value_set: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
      - name: potential_energy_rating
        description: "Energy rating band for domestic properties"
        tests:
          - dbt_expectations.expect_column_distinct_values_to_be_in_set:
              value_set: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
      - name: total_floor_area
        description: "Floor area of the building (m²)"
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1
              max_value: 20000
      - name: audit_id
        description: "Audit ID linking to the raw_copy_audit table"
        tests:
          - not_null
          - relationships:
              to: source('raw', 'raw_copy_audit')
              field: audit_id

  - name: stg_domestic_recommendations
    description: "Staging model for Domestic Recommendations linked to Certificates"
    columns:
      - name: lmk_key
        description: "Foreign key linking to stg_display_certificates"
        tests:
          - not_null
          - relationships:
              to: ref('stg_domestic_certificates')
              field: lmk_key
      - name: audit_id
        description: "Audit ID linking to the raw_copy_audit table"
        tests:
          - not_null
          - relationships:
              to: source('raw', 'raw_copy_audit')
              field: audit_id

  - name: stg_non_domestic_certificates
    description: "Staging model for Non-Domestic Certificates"
    columns:
      - name: lmk_key
        description: "Unique property key for the certificate"
        tests:
          - not_null
          - unique
      - name: floor_area
        description: "Floor area of the building (m²)"
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1
              max_value: 200000
              strictly: false
      - name: asset_rating_band
        description: "Energy Performance Asset Rating converted into an energy band/grade into a linear 'A+ to G' scale (non-domestic)"
        tests:
          - dbt_expectations.expect_column_distinct_values_to_be_in_set:
              value_set: ['A+', 'A', 'B', 'C', 'D', 'E', 'F', 'G']
      - name: audit_id
        description: "Audit ID linking to the raw_copy_audit table"
        tests:
          - not_null
          - relationships:
              to: source('raw', 'raw_copy_audit')
              field: audit_id

  - name: stg_non_domestic_recommendations
    description: "Staging model for Non-Domestic Recommendations linked to Certificates"
    columns:
      - name: lmk_key
        tests:
          - not_null
          - relationships:
              to: ref('stg_non_domestic_certificates')
              field: lmk_key
      - name: payback_type
        description: "TODO"
        tests:
          - not_null
      - name: audit_id
        tests:
          - not_null
          - relationships:
              to: source('raw', 'raw_copy_audit')
              field: audit_id